
plugins {
    id 'java'
    id 'io.quarkus' version '0.24.0'
}
//apply plugin: 'io.quarkus'

version = '0.0.0.6'

sourceCompatibility = 1.11

repositories {
    mavenCentral()
}

dependencies {
    compile project(":BaseCode")

    implementation enforcedPlatform('io.quarkus:quarkus-bom:0.24.0')
    implementation 'io.quarkus:quarkus-resteasy'
    //implementation 'io.quarkus:quarkus-resteasy-jackson'
    implementation 'io.quarkus:quarkus-elytron-security'

    testCompile group: 'io.quarkus', name: 'quarkus-junit5', version: '0.24.0'
    testCompile group: 'io.rest-assured', name: 'rest-assured', version: '3.3.0'
}

test {
    useJUnitPlatform()
}

task incrementBuildVersion {
    group "build"
    description "Increments the build number in the version config."

    doLast {
        def ver = version
        String lastNumber = ver.substring(ver.lastIndexOf('.') + 1)
        int increment = lastNumber.toInteger() + 1

        String firstNumber = ver.substring(0, ver.lastIndexOf("."))
        String result = buildFile.getText().replaceFirst("version = '$version'", "version = '" + firstNumber + "." + increment + "'")
        buildFile.setText(result)
    }
}

compileJava {
    println "Webserver version at compile time: " + version
    dependsOn ':BaseCode:test'
    dependsOn 'incrementBuildVersion';
}