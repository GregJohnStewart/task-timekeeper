/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.4.1/userguide/tutorial_java_projects.html
 */
plugins {
    // https://github.com/jeremylong/dependency-check-gradle
    //TODO:: re-enable when quarkus plays nice (webserver won't assemble with this)
//    id "org.owasp.dependencycheck" version "5.2.4"
}
allprojects {
    apply plugin: 'java'
    apply plugin: 'jacoco'
    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
    }
}
subprojects {
    //TODO:: re-enable when quarkus plays nice (webserver won't assemble with this)
//    apply plugin: 'org.owasp.dependencycheck'

    // task to increment the build version of sub projects
    task incrementBuildVersion {
        group "build"
        description "Increments the build number in the version config."

        doLast {
            def doBuildIncrement = false;
            if(doBuildIncrement) {
                def ver = version
                String lastNumber = ver.substring(ver.lastIndexOf('.') + 1)
                int increment = lastNumber.toInteger() + 1

                String firstNumber = ver.substring(0, ver.lastIndexOf("."))
                String result = buildFile.getText().replaceFirst("version = '$version'", "version = '" + firstNumber + "." + increment + "'")
                buildFile.setText(result)
            }
        }
    }
}
task codeCoverageReport(type: JacocoReport) {
    group "verification"
    description "Builds the coverage report from all sub projects' coverage reports."

    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    subprojects.each {
        sourceSets it.sourceSets.main
    }

    reports {
        xml.enabled true
//        xml.destination "${buildDir}/reports/jacoco/report.xml"
        html.enabled true
        csv.enabled true
    }
}
codeCoverageReport.dependsOn {
    subprojects*.test
}

/**
 * Task to update the gradle wrapper to the version set.
 */
task updateWrapper(type: Wrapper) {
    group "wrapper"
    description "Rebuilds the wrapper with the version set. Use to update to new versions of Gradle"
    gradleVersion = '5.6.1'
}
