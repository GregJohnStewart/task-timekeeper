import java.text.SimpleDateFormat

plugins {
    id 'java'
    id 'application'
}

sourceCompatibility = 1.8
//config for the application plugin
version '1.0'
mainClassName = "com.gjs.taskTimekeeper.desktopApp.Main"
applicationName = "Task Timekeeper"

repositories {
    mavenCentral()
}

dependencies {
    compile project(":BaseCode")

    //for processing command line arguments
    compile 'args4j:args4j:2.33'
    compile 'args4j:args4j-site:2.33'

    testCompile group: 'junit', name: 'junit', version: '4.12'
}

run {
    /*
	 * So we can have arguments passed to the program in gradle
	 *
	 * Example of usage:
	 *      gradle :DesktopApp:run -PappArgs="['-h']"
	 */
    if (project.hasProperty("appArgs")) {
        args Eval.me(appArgs)
    }
}

String projectPropertiesFile = "project.properties";
String projectPropertiesDir = "$projectDir/src/main/resources/";

/**
 * Writes out the version configuration for the app.
 */
//noinspection GroovyAssignabilityCheck
task writeVersionConfig() {
    doLast {
        String libVersion = project(":BaseCode").version;
        new File(projectPropertiesDir + projectPropertiesFile).text = """
################################################################
#                                                              #
# Main properties file. Contains values used in the app.       #
#                                                              #
# AUTOGENERATED BY GRADLE AT BUILD TIME. DO NOT EDIT THIS FILE #
#                                                              #
################################################################

# the name of the app
app.name = $applicationName
# the version of the app code
app.version = $version
# the time of build
app.buildtime: ${new SimpleDateFormat("dd-MM-yyyy HH:mm:ss").format(new Date())}
# Version of the library used
lib.version = $libVersion
#default save file location
default.configFile = ~/.timeKeeper/config.cfg
default.saveFile = ~/.timeKeeper/save.tks
#default run mode
default.runMode = SINGLE
"""
    }
}

task deleteVersionConfig(type: Delete) {
    delete fileTree(projectPropertiesDir) {
        include "**/$projectPropertiesFile"
    }
}

compileJava {
    dependsOn ':BaseCode:test'
    dependsOn 'writeVersionConfig';
}

clean {
    dependsOn 'deleteVersionConfig';
}